<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript 设计模式 | StudyTime</title>
    <meta name="description" content="记录和整理生活、工作与学习的知识，致力成为一名终身学习者！">
    <link rel="icon" href="/imags/favicon.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/imags/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.ed5c9324.css" as="style"><link rel="preload" href="/assets/js/app.0ab71c88.js" as="script"><link rel="preload" href="/assets/js/2.e4689b75.js" as="script"><link rel="preload" href="/assets/js/111.23239fca.js" as="script"><link rel="prefetch" href="/assets/js/10.77f70b77.js"><link rel="prefetch" href="/assets/js/100.6f6a6eec.js"><link rel="prefetch" href="/assets/js/101.2bfdb6d7.js"><link rel="prefetch" href="/assets/js/102.e4d72e8e.js"><link rel="prefetch" href="/assets/js/103.f032bd03.js"><link rel="prefetch" href="/assets/js/104.bdb29b99.js"><link rel="prefetch" href="/assets/js/105.8d648bb7.js"><link rel="prefetch" href="/assets/js/106.e42ccb21.js"><link rel="prefetch" href="/assets/js/107.fe4e7d66.js"><link rel="prefetch" href="/assets/js/108.4086560e.js"><link rel="prefetch" href="/assets/js/109.45799c6b.js"><link rel="prefetch" href="/assets/js/11.2fe3c188.js"><link rel="prefetch" href="/assets/js/110.324b9b74.js"><link rel="prefetch" href="/assets/js/112.0f7a2a2e.js"><link rel="prefetch" href="/assets/js/113.5f86b77b.js"><link rel="prefetch" href="/assets/js/114.65c405bc.js"><link rel="prefetch" href="/assets/js/115.42b6440f.js"><link rel="prefetch" href="/assets/js/116.2c7e6391.js"><link rel="prefetch" href="/assets/js/117.9f33e8d1.js"><link rel="prefetch" href="/assets/js/118.4e3d3d02.js"><link rel="prefetch" href="/assets/js/119.70a5b9b9.js"><link rel="prefetch" href="/assets/js/12.cad870c6.js"><link rel="prefetch" href="/assets/js/120.096fb4c3.js"><link rel="prefetch" href="/assets/js/121.aa4368ef.js"><link rel="prefetch" href="/assets/js/122.94d9fb82.js"><link rel="prefetch" href="/assets/js/123.dcea53c4.js"><link rel="prefetch" href="/assets/js/124.cfbd3623.js"><link rel="prefetch" href="/assets/js/125.6ef66ceb.js"><link rel="prefetch" href="/assets/js/126.fa7e32f6.js"><link rel="prefetch" href="/assets/js/127.79b6129e.js"><link rel="prefetch" href="/assets/js/128.f287c517.js"><link rel="prefetch" href="/assets/js/129.3137d7a5.js"><link rel="prefetch" href="/assets/js/13.f76cdcab.js"><link rel="prefetch" href="/assets/js/130.6b3fbaec.js"><link rel="prefetch" href="/assets/js/131.a59a25a2.js"><link rel="prefetch" href="/assets/js/132.8c3fe349.js"><link rel="prefetch" href="/assets/js/133.7e55bab9.js"><link rel="prefetch" href="/assets/js/134.23e5e39f.js"><link rel="prefetch" href="/assets/js/135.181d87d7.js"><link rel="prefetch" href="/assets/js/136.aaa06635.js"><link rel="prefetch" href="/assets/js/137.8412f5b4.js"><link rel="prefetch" href="/assets/js/138.3935094c.js"><link rel="prefetch" href="/assets/js/139.bcdb8a00.js"><link rel="prefetch" href="/assets/js/14.f2ffd9c1.js"><link rel="prefetch" href="/assets/js/140.a772dc41.js"><link rel="prefetch" href="/assets/js/141.b773587b.js"><link rel="prefetch" href="/assets/js/142.62a590bc.js"><link rel="prefetch" href="/assets/js/143.9accccf4.js"><link rel="prefetch" href="/assets/js/144.e231a51e.js"><link rel="prefetch" href="/assets/js/145.4ba04943.js"><link rel="prefetch" href="/assets/js/146.501d47fd.js"><link rel="prefetch" href="/assets/js/147.c287a571.js"><link rel="prefetch" href="/assets/js/148.b3ddd306.js"><link rel="prefetch" href="/assets/js/149.a20f6e62.js"><link rel="prefetch" href="/assets/js/15.c5576d12.js"><link rel="prefetch" href="/assets/js/150.560c6e84.js"><link rel="prefetch" href="/assets/js/151.8b84ce9e.js"><link rel="prefetch" href="/assets/js/152.54a8e990.js"><link rel="prefetch" href="/assets/js/153.ab01489c.js"><link rel="prefetch" href="/assets/js/154.131e3195.js"><link rel="prefetch" href="/assets/js/155.0fc0aa96.js"><link rel="prefetch" href="/assets/js/156.6491bcdf.js"><link rel="prefetch" href="/assets/js/157.73290791.js"><link rel="prefetch" href="/assets/js/158.f1858194.js"><link rel="prefetch" href="/assets/js/159.4c0ed64f.js"><link rel="prefetch" href="/assets/js/16.ff55c3c0.js"><link rel="prefetch" href="/assets/js/160.5f88557e.js"><link rel="prefetch" href="/assets/js/161.fb4f2cd9.js"><link rel="prefetch" href="/assets/js/162.9bb375f7.js"><link rel="prefetch" href="/assets/js/163.57baea55.js"><link rel="prefetch" href="/assets/js/164.bc425312.js"><link rel="prefetch" href="/assets/js/165.5c4413aa.js"><link rel="prefetch" href="/assets/js/166.84d0ada8.js"><link rel="prefetch" href="/assets/js/167.d69b75ce.js"><link rel="prefetch" href="/assets/js/168.f8c08b62.js"><link rel="prefetch" href="/assets/js/169.35adde8b.js"><link rel="prefetch" href="/assets/js/17.f2321484.js"><link rel="prefetch" href="/assets/js/170.17e881ca.js"><link rel="prefetch" href="/assets/js/171.8c5f5a53.js"><link rel="prefetch" href="/assets/js/172.9d3c7948.js"><link rel="prefetch" href="/assets/js/173.4898c778.js"><link rel="prefetch" href="/assets/js/174.ee2eb3bb.js"><link rel="prefetch" href="/assets/js/175.4773236c.js"><link rel="prefetch" href="/assets/js/176.77aaabdb.js"><link rel="prefetch" href="/assets/js/177.726af234.js"><link rel="prefetch" href="/assets/js/178.2d9ab08c.js"><link rel="prefetch" href="/assets/js/179.65df2c15.js"><link rel="prefetch" href="/assets/js/18.bfcfb961.js"><link rel="prefetch" href="/assets/js/180.4e0ebaa0.js"><link rel="prefetch" href="/assets/js/181.d87f3b52.js"><link rel="prefetch" href="/assets/js/182.8fa37ebc.js"><link rel="prefetch" href="/assets/js/183.5a4546ea.js"><link rel="prefetch" href="/assets/js/184.a126f06b.js"><link rel="prefetch" href="/assets/js/185.098f3b26.js"><link rel="prefetch" href="/assets/js/186.6755eec3.js"><link rel="prefetch" href="/assets/js/187.e17bf922.js"><link rel="prefetch" href="/assets/js/188.b4d8f28a.js"><link rel="prefetch" href="/assets/js/189.f27a5551.js"><link rel="prefetch" href="/assets/js/19.fd89f760.js"><link rel="prefetch" href="/assets/js/190.ab8968f0.js"><link rel="prefetch" href="/assets/js/191.f2b5e8ad.js"><link rel="prefetch" href="/assets/js/192.1748abf3.js"><link rel="prefetch" href="/assets/js/193.b5f42ce7.js"><link rel="prefetch" href="/assets/js/194.ca69b6dd.js"><link rel="prefetch" href="/assets/js/195.3e4962fa.js"><link rel="prefetch" href="/assets/js/196.2b4b0578.js"><link rel="prefetch" href="/assets/js/197.dd91c4cc.js"><link rel="prefetch" href="/assets/js/198.ba54fab7.js"><link rel="prefetch" href="/assets/js/199.f8b1f555.js"><link rel="prefetch" href="/assets/js/20.4e18dbd0.js"><link rel="prefetch" href="/assets/js/200.de2acfd0.js"><link rel="prefetch" href="/assets/js/201.56f5766f.js"><link rel="prefetch" href="/assets/js/202.c934640b.js"><link rel="prefetch" href="/assets/js/203.060e0f0f.js"><link rel="prefetch" href="/assets/js/204.3530d798.js"><link rel="prefetch" href="/assets/js/205.d08ac49a.js"><link rel="prefetch" href="/assets/js/206.2b35ce3a.js"><link rel="prefetch" href="/assets/js/207.3e4b0624.js"><link rel="prefetch" href="/assets/js/208.e277cc7d.js"><link rel="prefetch" href="/assets/js/209.3d64fe7d.js"><link rel="prefetch" href="/assets/js/21.8183a341.js"><link rel="prefetch" href="/assets/js/210.c05fc13d.js"><link rel="prefetch" href="/assets/js/211.8c883ddf.js"><link rel="prefetch" href="/assets/js/212.138472c4.js"><link rel="prefetch" href="/assets/js/213.56c8b61d.js"><link rel="prefetch" href="/assets/js/214.8a051e00.js"><link rel="prefetch" href="/assets/js/215.816a9a66.js"><link rel="prefetch" href="/assets/js/216.5edc0a15.js"><link rel="prefetch" href="/assets/js/217.6fddb1ce.js"><link rel="prefetch" href="/assets/js/218.7e205ee7.js"><link rel="prefetch" href="/assets/js/219.94300fff.js"><link rel="prefetch" href="/assets/js/22.46d7814e.js"><link rel="prefetch" href="/assets/js/220.799b91a7.js"><link rel="prefetch" href="/assets/js/221.2ccf1612.js"><link rel="prefetch" href="/assets/js/222.4d484345.js"><link rel="prefetch" href="/assets/js/223.b84684c1.js"><link rel="prefetch" href="/assets/js/224.98a3c1d5.js"><link rel="prefetch" href="/assets/js/225.6d233dd0.js"><link rel="prefetch" href="/assets/js/226.5dd1a462.js"><link rel="prefetch" href="/assets/js/227.962ae207.js"><link rel="prefetch" href="/assets/js/228.f4852ddb.js"><link rel="prefetch" href="/assets/js/229.83bd6c4d.js"><link rel="prefetch" href="/assets/js/23.0f8b5fc4.js"><link rel="prefetch" href="/assets/js/230.d68a43b9.js"><link rel="prefetch" href="/assets/js/231.8887ebd1.js"><link rel="prefetch" href="/assets/js/232.e4dfb19f.js"><link rel="prefetch" href="/assets/js/233.66c5e797.js"><link rel="prefetch" href="/assets/js/234.8e7aad0f.js"><link rel="prefetch" href="/assets/js/235.f008fdd3.js"><link rel="prefetch" href="/assets/js/236.175ce9bc.js"><link rel="prefetch" href="/assets/js/237.bb46bd43.js"><link rel="prefetch" href="/assets/js/238.d3703499.js"><link rel="prefetch" href="/assets/js/239.32779dc0.js"><link rel="prefetch" href="/assets/js/24.47ab0ac9.js"><link rel="prefetch" href="/assets/js/240.c5b387a0.js"><link rel="prefetch" href="/assets/js/241.197c1203.js"><link rel="prefetch" href="/assets/js/242.f70d9f3d.js"><link rel="prefetch" href="/assets/js/243.f9a69a0a.js"><link rel="prefetch" href="/assets/js/244.f1ab6417.js"><link rel="prefetch" href="/assets/js/245.e854412c.js"><link rel="prefetch" href="/assets/js/246.dd3bcd29.js"><link rel="prefetch" href="/assets/js/247.008b7a89.js"><link rel="prefetch" href="/assets/js/248.1a67b82b.js"><link rel="prefetch" href="/assets/js/249.4f6c1d97.js"><link rel="prefetch" href="/assets/js/25.8a21880f.js"><link rel="prefetch" href="/assets/js/250.50753d46.js"><link rel="prefetch" href="/assets/js/251.4d383a6c.js"><link rel="prefetch" href="/assets/js/252.e08c5d2b.js"><link rel="prefetch" href="/assets/js/253.aa4b6c6e.js"><link rel="prefetch" href="/assets/js/254.a33a10c2.js"><link rel="prefetch" href="/assets/js/255.882317fd.js"><link rel="prefetch" href="/assets/js/256.dc1b95d6.js"><link rel="prefetch" href="/assets/js/26.16a4d7de.js"><link rel="prefetch" href="/assets/js/27.7e683fb6.js"><link rel="prefetch" href="/assets/js/28.1fad6177.js"><link rel="prefetch" href="/assets/js/29.174570a7.js"><link rel="prefetch" href="/assets/js/3.b4ae3c02.js"><link rel="prefetch" href="/assets/js/30.922d32e3.js"><link rel="prefetch" href="/assets/js/31.8edc92b4.js"><link rel="prefetch" href="/assets/js/32.15f83336.js"><link rel="prefetch" href="/assets/js/33.1e01fdae.js"><link rel="prefetch" href="/assets/js/34.f05d5106.js"><link rel="prefetch" href="/assets/js/35.34cea3f2.js"><link rel="prefetch" href="/assets/js/36.b2fba1cc.js"><link rel="prefetch" href="/assets/js/37.7d65b74e.js"><link rel="prefetch" href="/assets/js/38.2497e7db.js"><link rel="prefetch" href="/assets/js/39.3b1b13c2.js"><link rel="prefetch" href="/assets/js/4.15abac35.js"><link rel="prefetch" href="/assets/js/40.3debec41.js"><link rel="prefetch" href="/assets/js/41.e08e844e.js"><link rel="prefetch" href="/assets/js/42.4bf5bd67.js"><link rel="prefetch" href="/assets/js/43.c6b44c4e.js"><link rel="prefetch" href="/assets/js/44.7ae47721.js"><link rel="prefetch" href="/assets/js/45.b1c5e47d.js"><link rel="prefetch" href="/assets/js/46.4cf2a988.js"><link rel="prefetch" href="/assets/js/47.f7c5a4e7.js"><link rel="prefetch" href="/assets/js/48.f350a3a5.js"><link rel="prefetch" href="/assets/js/49.305630a2.js"><link rel="prefetch" href="/assets/js/5.951dcd17.js"><link rel="prefetch" href="/assets/js/50.a96fe703.js"><link rel="prefetch" href="/assets/js/51.c03deac0.js"><link rel="prefetch" href="/assets/js/52.64d7bca3.js"><link rel="prefetch" href="/assets/js/53.85566d8f.js"><link rel="prefetch" href="/assets/js/54.30053348.js"><link rel="prefetch" href="/assets/js/55.d71cbc27.js"><link rel="prefetch" href="/assets/js/56.fe3c9554.js"><link rel="prefetch" href="/assets/js/57.e1740436.js"><link rel="prefetch" href="/assets/js/58.11ff07c5.js"><link rel="prefetch" href="/assets/js/59.72ed06cd.js"><link rel="prefetch" href="/assets/js/6.3109362c.js"><link rel="prefetch" href="/assets/js/60.b3adfccb.js"><link rel="prefetch" href="/assets/js/61.367d0d8a.js"><link rel="prefetch" href="/assets/js/62.ca3cb37c.js"><link rel="prefetch" href="/assets/js/63.112d3c15.js"><link rel="prefetch" href="/assets/js/64.459024dc.js"><link rel="prefetch" href="/assets/js/65.a7ba3a45.js"><link rel="prefetch" href="/assets/js/66.ee7a28ec.js"><link rel="prefetch" href="/assets/js/67.a250124b.js"><link rel="prefetch" href="/assets/js/68.f36e1962.js"><link rel="prefetch" href="/assets/js/69.9040e17b.js"><link rel="prefetch" href="/assets/js/7.3941f827.js"><link rel="prefetch" href="/assets/js/70.2e0db2a6.js"><link rel="prefetch" href="/assets/js/71.425f3a45.js"><link rel="prefetch" href="/assets/js/72.01d7fd45.js"><link rel="prefetch" href="/assets/js/73.b0edead8.js"><link rel="prefetch" href="/assets/js/74.a51846f8.js"><link rel="prefetch" href="/assets/js/75.98acd14a.js"><link rel="prefetch" href="/assets/js/76.1123f067.js"><link rel="prefetch" href="/assets/js/77.a2364be5.js"><link rel="prefetch" href="/assets/js/78.563f9b5a.js"><link rel="prefetch" href="/assets/js/79.af95d842.js"><link rel="prefetch" href="/assets/js/8.e3d26a41.js"><link rel="prefetch" href="/assets/js/80.531920e5.js"><link rel="prefetch" href="/assets/js/81.10db5c6c.js"><link rel="prefetch" href="/assets/js/82.4bc16187.js"><link rel="prefetch" href="/assets/js/83.34b0b844.js"><link rel="prefetch" href="/assets/js/84.58340b49.js"><link rel="prefetch" href="/assets/js/85.822ee9ce.js"><link rel="prefetch" href="/assets/js/86.619e31b4.js"><link rel="prefetch" href="/assets/js/87.04711855.js"><link rel="prefetch" href="/assets/js/88.1e9dc802.js"><link rel="prefetch" href="/assets/js/89.0d338477.js"><link rel="prefetch" href="/assets/js/9.3aac6a88.js"><link rel="prefetch" href="/assets/js/90.e1ce25e4.js"><link rel="prefetch" href="/assets/js/91.1dfd394d.js"><link rel="prefetch" href="/assets/js/92.7da92c0d.js"><link rel="prefetch" href="/assets/js/93.6766caba.js"><link rel="prefetch" href="/assets/js/94.fe8956c8.js"><link rel="prefetch" href="/assets/js/95.264271db.js"><link rel="prefetch" href="/assets/js/96.5f022ae7.js"><link rel="prefetch" href="/assets/js/97.c35b7da5.js"><link rel="prefetch" href="/assets/js/98.39981ade.js"><link rel="prefetch" href="/assets/js/99.136eda9d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ed5c9324.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="StudyTime" class="logo"> <span class="site-name can-hide">StudyTime</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">实验室</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Code</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/js/" class="nav-link router-link-active">Javascript</a></li><li class="dropdown-item"><!----> <a href="/code/ts/1-type.html" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/code/utils/" class="nav-link">工具方法</a></li><li class="dropdown-item"><!----> <a href="/code/libs/30sec.html" class="nav-link">库/框架</a></li><li class="dropdown-item"><!----> <a href="/code/designPatterns/single.html" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/code/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/code/docker/" class="nav-link">Docker</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Get it</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/getit/finance/" class="nav-link">Finance</a></li><li class="dropdown-item"><!----> <a href="/getit/math/001.html" class="nav-link">Math</a></li><li class="dropdown-item"><!----> <a href="/getit/day-know/001.html" class="nav-link">Day Know</a></li><li class="dropdown-item"><!----> <a href="/getit/life-algorithm/001.html" class="nav-link">Life Algorithm</a></li><li class="dropdown-item"><!----> <a href="/getit/economics/" class="nav-link">Economics</a></li><li class="dropdown-item"><!----> <a href="/getit/literature/" class="nav-link">Literature</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">实验室</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Code</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/js/" class="nav-link router-link-active">Javascript</a></li><li class="dropdown-item"><!----> <a href="/code/ts/1-type.html" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/code/utils/" class="nav-link">工具方法</a></li><li class="dropdown-item"><!----> <a href="/code/libs/30sec.html" class="nav-link">库/框架</a></li><li class="dropdown-item"><!----> <a href="/code/designPatterns/single.html" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/code/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/code/docker/" class="nav-link">Docker</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Get it</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/getit/finance/" class="nav-link">Finance</a></li><li class="dropdown-item"><!----> <a href="/getit/math/001.html" class="nav-link">Math</a></li><li class="dropdown-item"><!----> <a href="/getit/day-know/001.html" class="nav-link">Day Know</a></li><li class="dropdown-item"><!----> <a href="/getit/life-algorithm/001.html" class="nav-link">Life Algorithm</a></li><li class="dropdown-item"><!----> <a href="/getit/economics/" class="nav-link">Economics</a></li><li class="dropdown-item"><!----> <a href="/getit/literature/" class="nav-link">Literature</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/code/js/variable.html" class="sidebar-link">变量</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/code/js/types.html" class="sidebar-link">JS中的类型</a></li><li><a href="/code/js/this.html" class="sidebar-link">This</a></li><li><a href="/code/js/object.html" class="sidebar-link">对象 Object</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/code/js/array.html" class="sidebar-link">数组 Array</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/code/js/scope.html" class="sidebar-link">作用域</a></li><li><a href="/code/js/prototype.html" class="sidebar-link">Prototype 原型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/code/js/function.html" class="sidebar-link">call、apply、bind 方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/js/function.html#使用闭包" class="sidebar-link">使用闭包</a></li><li class="sidebar-sub-header"><a href="/code/js/function.html#constructor" class="sidebar-link">constructor</a></li></ul></li><li><a href="/code/js/regexp.html" class="sidebar-link">正则表达式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/code/js/math.html" class="sidebar-link">三角函数</a></li><li><a href="/code/js/es6.html" class="sidebar-link">ES6 语法与新特性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/js/es6.html#解构" class="sidebar-link">解构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/js/es6.html#解构数组" class="sidebar-link">解构数组</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#解构对象" class="sidebar-link">解构对象</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#解构参数" class="sidebar-link">解构参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#字符串模版" class="sidebar-link">字符串模版</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/js/es6.html#带标签的模版字符串" class="sidebar-link">带标签的模版字符串</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#判断是否包含其他字符串" class="sidebar-link">判断是否包含其他字符串</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#默认参数" class="sidebar-link">默认参数</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#展开操作符" class="sidebar-link">展开操作符</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#reset-剩余操作符" class="sidebar-link">reset 剩余操作符</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#有名函数" class="sidebar-link">有名函数</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#箭头函数" class="sidebar-link">箭头函数</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#对象表达式" class="sidebar-link">对象表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/js/es6.html#对比-2-个值是否相等" class="sidebar-link">对比 2 个值是否相等</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#对象复制" class="sidebar-link">对象复制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/js/es6.html#prototypeof" class="sidebar-link">prototypeOf</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#proto" class="sidebar-link">proto</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#super" class="sidebar-link">super</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#iterators" class="sidebar-link">iterators</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#generator" class="sidebar-link">generator</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#class-类" class="sidebar-link">class 类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/js/es6.html#类的-get-与-set" class="sidebar-link">类的 get 与 set</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#静态方法" class="sidebar-link">静态方法</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#extends-继承" class="sidebar-link">extends 继承</a></li></ul></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#set" class="sidebar-link">Set</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#entries" class="sidebar-link">entries</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#values" class="sidebar-link">values</a></li><li class="sidebar-sub-header"><a href="/code/js/es6.html#padstart" class="sidebar-link">padStart</a></li></ul></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="javascript-设计模式"><a href="#javascript-设计模式" aria-hidden="true" class="header-anchor">#</a> JavaScript 设计模式</h1> <p>全局变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 不要使用这样的方式赋值，当你这样赋值的时候，b就变成了全局变量</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> b <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><p>for循环中缓存 数组（或容器）的长度，会大大提高速度，其中在safari3中提高2倍以上，IE7中提高170倍</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> ary<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>现在的浏览器已经针对for循环做了处理</p></blockquote> <p>将变量放到循环外面</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">looper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      len <span class="token operator">=</span> ary<span class="token punctuation">.</span>length

  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用<code>i++</code> 替代以下两种表达式</p> <div class="language-js extra-class"><pre class="language-js"><code>i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
i <span class="token operator">+=</span> <span class="token number">1</span>
</code></pre></div><p>for-in 循环</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> man <span class="token operator">=</span> <span class="token punctuation">{</span>
  hands<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  legs<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  heads<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> man<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>man<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> man<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> i<span class="token punctuation">,</span>
  hasOwn <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasOwnProperty
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> man<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>man<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> man<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>不要增加内置的原型，如果非要添加，可以采用下面的方式增加判断</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>myMethod <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// doSomeThing</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>避免使用隐式转换,为了避免隐式类型转换导致的混淆不清，使用<code>===</code>和 <code>!==</code>来比较</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> zero <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>zero <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// zero 是 0， 而不是false， 不会执行到这里</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>zero <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 代码会走这里来</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写API文档</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 翻转一个字符串
 * @param  {string} 输入需要翻转的字符串
 * @return {string} 翻转后的字符串
 */</span>
<span class="token keyword">var</span> <span class="token function-variable function">reverse</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str
<span class="token punctuation">}</span>
</code></pre></div><p>命名空间</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token constant">MYAPP</span><span class="token punctuation">.</span>math_stuff <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 加法
   * @param  {Number} 第一个数
   * @param  {Number} 第二个数
   * @return {Number} 两个输入的总和
   */</span>
  <span class="token function-variable function">sun</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 乘法
   * @param  {Number} 第一个数字
   * @param  {Number} 第二个数字
   * @return {Number} 两个数字相乘的结果
   */</span>
  <span class="token function-variable function">multi</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">*</span> b
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token punctuation">,</span> last</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 人的姓
   * @type {String}
   */</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> first
  <span class="token comment">/**
   * 人的名
   * @type {String}
   */</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> last
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @method getName
 * @return {String} 人的姓名
 */</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName
<span class="token punctuation">}</span>

</code></pre></div><h3 id="字面量和构造函数"><a href="#字面量和构造函数" aria-hidden="true" class="header-anchor">#</a> 字面量和构造函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> Array<span class="token punctuation">.</span>isArray <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Array<span class="token punctuation">.</span><span class="token function-variable function">isArray</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Array]'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>错误对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'MyErrorType'</span><span class="token punctuation">,</span> <span class="token comment">// 自定义错误类型</span>
    message<span class="token punctuation">:</span> <span class="token string">'oops'</span><span class="token punctuation">,</span>
    extra<span class="token punctuation">:</span> <span class="token string">'This was rather embrrassing'</span><span class="token punctuation">,</span>
    remedy<span class="token punctuation">:</span> errorHandler <span class="token comment">// 指定应该处理该错误的函数</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    e<span class="token punctuation">.</span><span class="token function">remedy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用函数errorHandler</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>回调函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">findNodes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">,</span>  <span class="token comment">// 大而繁重的循环</span>
      nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 存储结果</span>
      fonud<span class="token punctuation">;</span> <span class="token comment">// 找到下一个节点</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i<span class="token operator">--</span>
    nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> nodes
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">hide</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nodes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    max <span class="token operator">=</span> nodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">hide</span><span class="token punctuation">(</span><span class="token function">findNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>以上的代码实现是低效的，因为hide() 必须再次循环遍历由findNodes()返回的数组节点，如果能避免这种循环，并且只要在findeNodes()中选择变可实现隐藏逻辑，由于检索和修改逻辑耦合，那么它不再是一个通用函数。对于这种问题解决的方法是采用回调函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 重构findNodes() 接受一个回调函数作为参数</span>
<span class="token keyword">var</span> <span class="token function-variable function">findNodes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">,</span>
      nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      found<span class="token punctuation">;</span>

  <span class="token comment">// 检查回调函数</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i<span class="token operator">--</span>

    <span class="token comment">// 运行回调</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> nodes
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">hide</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  node<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 找到指定节点，将其隐藏</span>
<span class="token function">findNodes</span><span class="token punctuation">(</span>hide<span class="token punctuation">)</span>

<span class="token comment">// 传递一个匿名函数</span>
<span class="token function">findNodes</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  node<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>回调与作用域</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myapp <span class="token operator">=</span> <span class="token punctuation">{</span>
  color<span class="token punctuation">:</span> <span class="token string">'green'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">paint</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">findNodes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token function">findNodes</span><span class="token punctuation">(</span>myapp<span class="token punctuation">.</span>paint<span class="token punctuation">)</span>
</code></pre></div><p>上面的代码将会报错，this.color没有被定义，由于findNodes() 是一个全局函数，因此，对象this指向全局对象</p> <p>解决方案，将对象传递进去， 结合call()或者apply()来修改this指向</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">findNodes</span><span class="token punctuation">(</span>myapp<span class="token punctuation">.</span>paint<span class="token punctuation">,</span> myapp<span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token function-variable function">findNodes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> cbObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>cbObj<span class="token punctuation">,</span> found<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>传递一个对象和一个方法以用做回调函数的另外一种选择是，将其中的方法作为字符串来传递，无需重复输入该对象名称</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">findNodes</span><span class="token punctuation">(</span><span class="token string">'paint'</span><span class="token punctuation">,</span> myapp<span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token function-variable function">findNodes</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> cbObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> cbObj<span class="token punctuation">[</span>callback<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>cbObj<span class="token punctuation">,</span> found<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>返回函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">setup</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> my <span class="token operator">=</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// alerts 1</span>
<span class="token function">my</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// alerts 2</span>

<span class="token keyword">var</span> <span class="token function-variable function">setup</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>count<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> next <span class="token operator">=</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><p>自定义函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">scareMe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token function-variable function">scareMe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'double 1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">scareMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token function">scareMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// double 1</span>

</code></pre></div><p>及时函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hahah'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'xixi'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>及时函数参数传递</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">who<span class="token punctuation">,</span> when</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I met '</span> <span class="token operator">+</span> who <span class="token operator">+</span> <span class="token string">'on '</span> <span class="token operator">+</span> when<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'Joe Black, new Date()'</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
</code></pre></div><p>及时函数返回值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 另一种写法</span>
<span class="token keyword">var</span> <span class="token function-variable function">res</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 另一种写法</span>
<span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> getResult <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>使用及时函数定义对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  message<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> who <span class="token operator">=</span> <span class="token string">'me'</span>
    <span class="token keyword">var</span> what <span class="token operator">=</span> <span class="token string">'call'</span>
    <span class="token keyword">return</span> what <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> who
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getMsg</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// call me</span>
obj<span class="token punctuation">.</span>message  <span class="token comment">// call me</span>
</code></pre></div><p>及时对象初始化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 定义初始设定值</span>
  <span class="token comment">// 又名配置常数</span>
  maxWidth<span class="token punctuation">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
  maxHeight<span class="token punctuation">:</span> <span class="token number">450</span><span class="token punctuation">,</span>
  <span class="token comment">// 还可以定义一些使用的方法</span>
  <span class="token function-variable function">gimmeMac</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxWidth <span class="token operator">+</span> <span class="token string">' * '</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxHeight
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">init</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">gimmeMac</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 更多初始化任务</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 这2种方式都可以</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>这种模式主要适用于一次性任务，而且在init()完毕后也没有对该对象的访问。如果想在init()完毕后保存该对象的一个引用，可以通过init()尾部添加<code>return this</code>语句实现该功能</p></blockquote> <p>初始化分支</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 之前</span>

<span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">addListener</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>addEventListener <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> doucment<span class="token punctuation">.</span>attachEvent <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> fn
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">removeListener</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 优化之后</span>
<span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token punctuation">{</span>
  addListener<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  removeListener<span class="token punctuation">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>addEventListener <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  utils<span class="token punctuation">.</span><span class="token function-variable function">addListener</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  utils<span class="token punctuation">.</span><span class="token function-variable function">removeListener</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> doucment<span class="token punctuation">.</span>attachEvent <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  utils<span class="token punctuation">.</span><span class="token function-variable function">addListener</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  utils<span class="token punctuation">.</span><span class="token function-variable function">removeListener</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">detachEvent</span><span class="token punctuation">(</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  utils<span class="token punctuation">.</span><span class="token function-variable function">addListener</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> fn
  <span class="token punctuation">}</span>
  utils<span class="token punctuation">.</span><span class="token function-variable function">removeListener</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数属性--备忘模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment">// 3</span>

<span class="token keyword">var</span> <span class="token function-variable function">myFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>myFunc<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>param<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    myFunc<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>param<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> myFunc<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>param<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
myFunc<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token keyword">var</span> <span class="token function-variable function">myFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cacheKey <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>myFunc<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>cacheKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    myFunc<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>cacheKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> myFunc<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>cacheKey<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
myFunc<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>配置对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addPerson</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token punctuation">,</span> last</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 后来需求改变，需要添加工作，性别，地址等信息</span>
<span class="token keyword">function</span> <span class="token function">addPerson</span><span class="token punctuation">(</span><span class="token parameter">first<span class="token punctuation">,</span> last<span class="token punctuation">,</span> job<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> addr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 参数传递太多不太方便，用配置对象的方式传递参数</span>

<span class="token function">addPerson</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

<span class="token keyword">var</span> conf <span class="token operator">=</span> <span class="token punctuation">{</span>
  first<span class="token punctuation">:</span> <span class="token string">'batman'</span><span class="token punctuation">,</span>
  last<span class="token punctuation">:</span> <span class="token string">'Wayne'</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置对象的优点：</p> <ul><li>不需要记住众多的参数以及顺序</li> <li>可以安全忽略可选参数</li> <li>更易于添加和删除参数</li></ul> <p>配置对象的缺点：</p> <ul><li>需要记住参数名称
-属性名称无法被压缩</li></ul> <h4 id="curry"><a href="#curry" aria-hidden="true" class="header-anchor">#</a> Curry</h4> <p>函数应用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">who</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> who <span class="token operator">+</span> <span class="token string">'!'</span>
<span class="token punctuation">}</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello !'</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello World!'</span>
<span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello Hello!'</span>
</code></pre></div><p>当函数是对象的方法时候，此时不能传递<code>null</code>引用，在这种情况下，这里的对象将成为<code>apply()</code>的第一个参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> alien <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">sayHi</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">who</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> who <span class="token operator">+</span> <span class="token string">'!'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

alien<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token string">'me'</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello me'</span>
<span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>alien<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'abcd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello abcd'</span>
<span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>alien<span class="token punctuation">,</span> <span class="token string">'abcd'</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello abcd'</span>
</code></pre></div><p>curry化的add()函数
// 接受部分参数列表</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> oldX <span class="token operator">=</span> x<span class="token punctuation">,</span> oldY <span class="token operator">=</span> y
  <span class="token comment">// 如果只传了一个数，就在返回一个函数</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> oldY <span class="token operator">==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> oldX <span class="token operator">+</span> newY
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 完全应用</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 42</span>
<span class="token keyword">var</span> add1 <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token function">add1</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// 30</span>
</code></pre></div><p>精简add()函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> y <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> x <span class="token operator">+</span> y
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>
</code></pre></div><p>通用的curry化函数示例</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment">// function add(x, y) {return x + y }</span>
    <span class="token keyword">var</span> _slice <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">,</span>
      _args <span class="token operator">=</span> <span class="token function">_slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token comment">// _args 2</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> newArgs <span class="token operator">=</span> <span class="token function">_slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
        args2 <span class="token operator">=</span> _args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newArgs<span class="token punctuation">)</span>
      <span class="token comment">// newArgs 3</span>
      <span class="token comment">// args2 [2, 3]</span>
      <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>

<span class="token keyword">var</span> newAdd <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>何时使用Curry化？
当发现正在调用同一个函数，并且传递的参数绝大多数都是相同的，那么该函数可能适用于Curry化的一个很好的候选参数。</p> <p>小结：
创建函数的语法</p> <ol><li>命名函数表达式</li> <li>匿名函数表达式</li> <li>函数声明</li> <li>对象函数</li> <li>函数原型方法</li></ol> <ul><li>API模式， 可以帮助函数提供更整洁的接口</li></ul> <p>回调模式 =&gt; 将函数作为参数传递
配置对象 =&gt; 有助于保持控制函数的参数数量
返回函数 =&gt; 返回值为另外一个函数
Curry化 =&gt; 当新函数是基于现有函数，并加上部分参数列表创建时</p> <ul><li>初始化模式</li></ul> <p>及时函数 =&gt; 只要定义之后立即执行
及时对象初始化 =&gt; 提供了可被立即调用的方法
初始化分支 =&gt; 帮助分支在代码初始化执行过程中仅检测一次，这与以后在程序生命期内多次检测相反</p> <ul><li>性能模式
备忘模式（缓存） =&gt; 使用函数属性以便使得计算过的值无须再次计算
自定义模式 =&gt; 以新的主体重写本身，以使得在第二次或以后调用时仅需执行更少的工作</li></ul> <h3 id="对象创建模式"><a href="#对象创建模式" aria-hidden="true" class="header-anchor">#</a> 对象创建模式</h3> <h4 id="命名空间模式"><a href="#命名空间模式" aria-hidden="true" class="header-anchor">#</a> 命名空间模式</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function-variable function">Parent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'apple'</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span>module1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span>module1<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span>module2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>命名空间的缺点：</p> <ul><li>需要更多的字符，每个变量都要加上命名空间的前缀，增加代码量</li> <li>仅有一个全家实例意味着任何代码都可以修改该全局实例，并且其余的功能获得更新后的状态</li> <li>长嵌套名字意味更长（更慢）的属性解析查询时间</li></ul> <p>命名空间函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token constant">MYAPP</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function-variable function">namespace</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nsStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> parts <span class="token operator">=</span> nsStr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      parent <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">,</span>
      i<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;MYAPP&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parts <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    parent <span class="token operator">=</span> parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> parent
<span class="token punctuation">}</span>
</code></pre></div><p>私有变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'apple'</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> otc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>otc<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>otc<span class="token punctuation">.</span>getName<span class="token punctuation">)</span> <span class="token comment">// 'apple'</span>
</code></pre></div><p>私有性失效</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
    age<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'bob'</span><span class="token punctuation">,</span>
    weight<span class="token punctuation">:</span> <span class="token string">'70kg'</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> <span class="token string">'179cm'</span><span class="token punctuation">,</span>
    price<span class="token punctuation">:</span> <span class="token string">'1亿'</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>info
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> badBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> info <span class="token operator">=</span> badBody<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
info<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">100</span>
info<span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token string">'-10'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>badBody<span class="token punctuation">.</span>getInfo<span class="token punctuation">)</span>

<span class="token comment">// age: 100</span>
<span class="token comment">// price: '-10'</span>
</code></pre></div><p>对象字面量以及私有性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function">myobj</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'my name'</span>
  <span class="token comment">// 实现共有部分</span>
  myobj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

myobj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'my name'</span>
</code></pre></div><p>模块模式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myboj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 私有成员</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'my name'</span>

  <span class="token comment">// 实现共有部分</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

myobj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'my name'</span>
</code></pre></div><p>原型和私有性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'lyz'</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token string">'Mobile Webkit'</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getBrowser</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> browser
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> toy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>toy<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>toy<span class="token punctuation">.</span><span class="token function">getBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>将私有方法揭示为公共方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function">myarr</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> astr <span class="token operator">=</span> <span class="token string">'[objcet Array]'</span><span class="token punctuation">,</span>
      toString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString

  <span class="token keyword">function</span> <span class="token function">isArray</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">===</span> astr
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token parameter">hasStack<span class="token punctuation">,</span> needle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      len <span class="token operator">=</span> hasStack<span class="token punctuation">.</span>length
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>hasStack<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> needle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> i
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span>

  myarr <span class="token operator">=</span> <span class="token punctuation">{</span>
    isArray<span class="token punctuation">:</span> isArray<span class="token punctuation">,</span>
    indexOf<span class="token punctuation">:</span> indexOf<span class="token punctuation">,</span>
    inArray<span class="token punctuation">:</span> indexOf
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>如果发生意外的事情，例如公用indexOf()方法发生意外，但私有的indexOf()方法任然是安全的</p> <div class="language-js extra-class"><pre class="language-js"><code>myarr<span class="token punctuation">.</span>indexOf <span class="token operator">=</span> <span class="token keyword">null</span>
myarr<span class="token punctuation">.</span><span class="token function">inArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
</code></pre></div><p>模块模式</p> <ul><li>命名空间</li> <li>即时函数</li> <li>私有和特权会员</li> <li>声明依赖</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 命名空间</span>
<span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">'MYAPP.utils.arr'</span><span class="token punctuation">)</span>

<span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>arr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 依赖</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
      ulang <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>lang<span class="token punctuation">,</span>

      <span class="token comment">// 私有属性</span>
      arr_str <span class="token operator">=</span> <span class="token string">'[object Array]'</span><span class="token punctuation">,</span>
      toString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">,</span>

      <span class="token comment">// 私有方法</span>
      <span class="token function-variable function">inArr</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">hayStack<span class="token punctuation">,</span> needle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> hayStack<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>hayStack<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> needle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">isArr</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">===</span> arr_str
      <span class="token punctuation">}</span>
      <span class="token comment">// ... 其他方法和属性</span>

  <span class="token comment">// 可选的一次性初始化过程</span>

  <span class="token comment">// 揭示公有API</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    isArray<span class="token punctuation">:</span> isArr<span class="token punctuation">,</span>
    indexOf<span class="token punctuation">:</span> inArr
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>创建构造函数的模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">'MYAPP.utils.Array'</span><span class="token punctuation">)</span>

<span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>Array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 依赖</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
      ulang <span class="token operator">=</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>lang<span class="token punctuation">,</span>
      <span class="token comment">// 私有方法</span>
      Constr<span class="token punctuation">;</span>
  <span class="token comment">// 可选的一次性初始化过程</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// 公有API--构造函数</span>
  <span class="token function-variable function">Constr</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 公有API--原型</span>
  <span class="token class-name">Constr</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    constructor<span class="token punctuation">:</span> <span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>Array<span class="token punctuation">,</span>
    version<span class="token punctuation">:</span> <span class="token string">'2.0'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">toArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> len <span class="token operator">=</span> obj<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> a
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 返回要分配给新命名空间的构造函数</span>
  <span class="token keyword">return</span> Constr
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>使用新构造函数的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MYAPP<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>Array</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
</code></pre></div><p>将全局变量导入到模块中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">MYAPP</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> global</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 引用全局对象</span>
  <span class="token comment">// 以及现在被转换成局部变量的</span>
  <span class="token comment">// 全局应用程序命名空间对象</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token constant">MYAPP</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="沙箱模式"><a href="#沙箱模式" aria-hidden="true" class="header-anchor">#</a> 沙箱模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Sendbox</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ajax'</span><span class="token punctuation">,</span> <span class="token string">'event'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">Sendbox</span><span class="token punctuation">(</span><span class="token string">'ajax'</span><span class="token punctuation">,</span> <span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">Sendbox</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">Sendbox</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">Sendbox</span><span class="token punctuation">(</span><span class="token string">'dom'</span><span class="token punctuation">,</span> <span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Sendbox</span><span class="token punctuation">(</span><span class="token string">'ajax'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>增加模块</p> <div class="language-js extra-class"><pre class="language-js"><code>Sandbox<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function-variable function">dom</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">.</span><span class="token function-variable function">getElement</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  box<span class="token punctuation">.</span><span class="token function-variable function">getStyle</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  box<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'bar'</span>
<span class="token punctuation">}</span>

Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function-variable function">event</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">.</span><span class="token function-variable function">attachEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  box<span class="token punctuation">.</span><span class="token function-variable function">dettachEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function-variable function">ajax</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">box</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  box<span class="token punctuation">.</span><span class="token function-variable function">makeRequest</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  box<span class="token punctuation">.</span><span class="token function-variable function">getRequest</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实现构造函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 将参数转换为数组</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 最后一个是回调函数</span>
      callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 模块可以作为数组，或作为单独参数传递</span>
      modules <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token operator">?</span> args <span class="token punctuation">:</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      i<span class="token punctuation">;</span>
  <span class="token comment">// 确保该函数作为构造函数被调用</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Sandbox</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Sandbox</span><span class="token punctuation">(</span>modules<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 需要向this添加的属性</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span>

  <span class="token comment">// 向this对象添加模块，不指定或指定‘*’ 都表示使用所有模块</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>modules <span class="token operator">||</span> modules <span class="token operator">===</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>hasOwnProperty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        modules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 初始化所需模块</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>modules<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// call the callback</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Sandbox</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'My Sendbox'</span><span class="token punctuation">,</span>
  version<span class="token punctuation">:</span> <span class="token string">'1.0'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>公有静态成员</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 构造函数</span>
<span class="token keyword">var</span> <span class="token function-variable function">Gadget</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 静态方法</span>
Gadget<span class="token punctuation">.</span><span class="token function-variable function">isShiny</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'you bet'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 原型上的普通方法</span>
<span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setPrice</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price
<span class="token punctuation">}</span>

Gadget<span class="token punctuation">.</span><span class="token function">isShiny</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'you bet'</span>

<span class="token keyword">var</span> iphone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
iphone<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">398</span><span class="token punctuation">)</span>

<span class="token comment">// 试图以静态方式调用一个实例方法是无法运行的</span>
<span class="token keyword">typeof</span> Gadget<span class="token punctuation">.</span>setPrice   <span class="token comment">// 'undefined'</span>
<span class="token keyword">typeof</span> iphone<span class="token punctuation">.</span>isShiny   <span class="token comment">// 'undefined'</span>

</code></pre></div><p>静态方法与实例连接起来</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isShiny <span class="token operator">=</span> Gadget<span class="token punctuation">.</span>isShiny

iphone<span class="token punctuation">.</span><span class="token function">isShiny</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'you bet'</span>
</code></pre></div><p>在这种情况下，如果静态方法内部使用了this要特别注意，如果执行iphone.isShiny(),那么this将会指向iphone</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 构造函数</span>
<span class="token keyword">var</span> <span class="token function-variable function">Gadget</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price
<span class="token punctuation">}</span>

<span class="token comment">// 静态方法</span>
Gadget<span class="token punctuation">.</span><span class="token function-variable function">isShiny</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token string">'you bet'</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Gadget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    msg <span class="token operator">+=</span> <span class="token string">', it costs $'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">+</span> <span class="token string">'!'</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> msg
<span class="token punctuation">}</span>

<span class="token comment">// 向该原型添加一个普通的方法</span>
<span class="token class-name">Gadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">isShiny</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Gadget<span class="token punctuation">.</span><span class="token function">isShiny</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试静态方法</span>
Gadget<span class="token punctuation">.</span><span class="token function">isShiny</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'you bet'</span>

<span class="token comment">// 测试实例方法</span>
<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token string">'199'</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span><span class="token function">isShiny</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'you bet, it costs $199 !'</span>
</code></pre></div><p>私有静态成员</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">var</span> Gadget <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 静态变量/属性</span>
  <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      NewGadget

  <span class="token comment">// 新的构造函数实现</span>
  <span class="token function-variable function">NewGadget</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counter <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 特权方法</span>
  <span class="token class-name">NewGadget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getLastId</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> counter
  <span class="token punctuation">}</span>
  <span class="token comment">// 覆盖该构造函数</span>
  <span class="token keyword">return</span> NewGadget
 <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> iphone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
iphone<span class="token punctuation">.</span><span class="token function">getLastId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token keyword">var</span> iphone2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
iphone2<span class="token punctuation">.</span><span class="token function">getLastId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token keyword">var</span> iphone3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
iphone3<span class="token punctuation">.</span><span class="token function">getLastId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><p>对象常量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> constant <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> constants <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      hasOwn <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasOwnProperty<span class="token punctuation">,</span>
      allowed <span class="token operator">=</span> <span class="token punctuation">{</span>
        string<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        number<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        boolean<span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      prefix <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDefined</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>allowed<span class="token punctuation">,</span> <span class="token keyword">typeof</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      constants<span class="token punctuation">[</span>prefix <span class="token operator">+</span> name<span class="token punctuation">]</span> <span class="token operator">=</span> value
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">isDefined</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">hasOwn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>constants<span class="token punctuation">,</span> prefix <span class="token operator">+</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDefined</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> constants<span class="token punctuation">[</span>prefix <span class="token operator">+</span> name<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">// 检查是否已经定义</span>
constant<span class="token punctuation">.</span><span class="token function">isDefined</span><span class="token punctuation">(</span><span class="token string">'maxwidth'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token comment">// 定义</span>
constant<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'maxwidth'</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token comment">// 再次检查</span>
constant<span class="token punctuation">.</span><span class="token function">isDefined</span><span class="token punctuation">(</span><span class="token string">'maxwidth'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token comment">// 试图重新定义</span>
constant<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'maxwidth'</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token comment">// 该值是否保持不变</span>
constant<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'maxwidth'</span><span class="token punctuation">)</span> <span class="token comment">// 600</span>
</code></pre></div><h4 id="链模式"><a href="#链模式" aria-hidden="true" class="header-anchor">#</a> 链模式</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function-variable function">increment</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">+=</span> v
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">shout</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 5</span>
obj<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span><span class="token function">shout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>Method()</code>方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>method <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> impementation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> impementation
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'getName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">'setName'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> r<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'administartor'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

</code></pre></div><h3 id="代码复用模式"><a href="#代码复用模式" aria-hidden="true" class="header-anchor">#</a> 代码复用模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父构造函数</span>
<span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'lyz'</span>
<span class="token punctuation">}</span>
<span class="token comment">// 原型上的普通方法</span>
<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token comment">// 空白的子构造函数</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 继承</span>
<span class="token function">inherit</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span> Parent<span class="token punctuation">)</span>
</code></pre></div><h4 id="类式继承模式-1-默认模式"><a href="#类式继承模式-1-默认模式" aria-hidden="true" class="header-anchor">#</a> 类式继承模式#1 -- 默认模式</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">C</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">P</span>
<span class="token punctuation">}</span>
</code></pre></div><p>重要的是需要记住，原型属性应该指向一个对象，而不是一个函数，因此它必须指向一个由父构造函数所创建的实例（一个对象），而不是构造函数本身。也就是说，要注意使用new操作符来创建新对象。因为需要new才能使用这种模式运行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> kid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
kid<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'lyz'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> kid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
kid<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'anne'</span>
kid<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'anne'</span>
</code></pre></div><h4 id="类式继承模式-2-借用构造函数"><a href="#类式继承模式-2-借用构造函数" aria-hidden="true" class="header-anchor">#</a> 类式继承模式#2 -- 借用构造函数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父类构造函数</span>
<span class="token keyword">function</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> article <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 文章对象继承了article对象</span>
<span class="token keyword">function</span> <span class="token function">BlogPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">BlogPost</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> article

<span class="token keyword">var</span> blog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlogPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 静态页面继承了article</span>
<span class="token comment">// 借用构造函数模式</span>
<span class="token keyword">function</span> <span class="token function">StaticPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Article</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'tags'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'tags'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'tags'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// true</span>

blog<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span>
page<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'php'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// js, css, html</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name  <span class="token operator">||</span> <span class="token string">'lyz'</span>
<span class="token punctuation">}</span>
<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> kid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'Patrick'</span><span class="token punctuation">)</span>
kid<span class="token punctuation">.</span>name  <span class="token comment">// 'Patrick'</span>
<span class="token keyword">typeof</span> kid<span class="token punctuation">.</span>say <span class="token comment">// 'undefined'</span>
</code></pre></div><h4 id="借用构造函数实现多重继承"><a href="#借用构造函数实现多重继承" aria-hidden="true" class="header-anchor">#</a> 借用构造函数实现多重继承</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">=</span> <span class="token number">4</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'meaowww'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Bird</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>wings <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fly <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">CatWings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Cat</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token function">Bird</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> jane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CatWings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>jane<span class="token punctuation">)</span>
</code></pre></div><h4 id="类式继承模式-3-借用和设置原型"><a href="#类式继承模式-3-借用和设置原型" aria-hidden="true" class="header-anchor">#</a> 类式继承模式#3 -- 借用和设置原型</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="类式继承模式-4-共享原型"><a href="#类式继承模式-4-共享原型" aria-hidden="true" class="header-anchor">#</a> 类式继承模式#4 -- 共享原型</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">C</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
<span class="token punctuation">}</span>
</code></pre></div><h4 id="类式继承模式-5-临时构造函数"><a href="#类式继承模式-5-临时构造函数" aria-hidden="true" class="header-anchor">#</a> 类式继承模式#5 -- 临时构造函数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">F</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
  <span class="token class-name">C</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="存储超类"><a href="#存储超类" aria-hidden="true" class="header-anchor">#</a> 存储超类</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">F</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
  <span class="token class-name">C</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token constant">C</span><span class="token punctuation">.</span>uber <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
<span class="token punctuation">}</span>
</code></pre></div><h4 id="重置构造函数指针"><a href="#重置构造函数指针" aria-hidden="true" class="header-anchor">#</a> 重置构造函数指针</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">F</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
  <span class="token class-name">C</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token constant">C</span><span class="token punctuation">.</span>uber <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
  <span class="token class-name">C</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> <span class="token constant">C</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="缓存代理构造函数，仅创建一次临时构造函数"><a href="#缓存代理构造函数，仅创建一次临时构造函数" aria-hidden="true" class="header-anchor">#</a> 缓存代理构造函数，仅创建一次临时构造函数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> inherit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">F</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
    <span class="token class-name">C</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token constant">C</span><span class="token punctuation">.</span>uber <span class="token operator">=</span> <span class="token class-name">P</span><span class="token punctuation">.</span>prototype
    <span class="token class-name">C</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> <span class="token constant">C</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="原型继承"><a href="#原型继承" aria-hidden="true" class="header-anchor">#</a> 原型继承</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 要继承的对象</span>
<span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Papa'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 新对象</span>
<span class="token keyword">var</span> child <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Papa</span>

<span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'lyz'</span>
<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">var</span> papa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> kid <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>papa<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>kid<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'lyz'</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'lyz'</span>
<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">var</span> kid <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> kid<span class="token punctuation">.</span>getName<span class="token punctuation">)</span> <span class="token comment">// function</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> kid<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// undefined 只有原型是继承的，属性并没有继承到</span>
</code></pre></div><h4 id="object-create增加到ecmascript中"><a href="#object-create增加到ecmascript中" aria-hidden="true" class="header-anchor">#</a> <code>Object.create</code>增加到ECMAScript中</h4> <p>在ECMAScript中，原型继承模式已经正式成为该语言的一部分。这种模式通过Object.create()来实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> child <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
</code></pre></div><p>Object.create()接受一个额外的参数，即一个对象。这个额外的对象的属性将会被添加到新对象中，以此作为新对象自身的属性，然后Object.create()返回该新对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> child <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  age<span class="token punctuation">:</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

child<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><h4 id="通过复制属性实现继承"><a href="#通过复制属性实现继承" aria-hidden="true" class="header-anchor">#</a> 通过复制属性实现继承</h4> <p>浅复制</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  child <span class="token operator">=</span> child <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> child
<span class="token punctuation">}</span>
</code></pre></div><p>深度复制</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">extendDeep</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">,</span>
      _toString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">,</span>
      astr <span class="token operator">=</span> <span class="token string">'[object Array]'</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        child<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">_toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'astr'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token function">extendDeep</span><span class="token punctuation">(</span>parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> child<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        child<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> parent<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> child
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> papa <span class="token operator">=</span> <span class="token punctuation">{</span>
  counts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  reads<span class="token punctuation">:</span> <span class="token punctuation">{</span> paper<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> kid <span class="token operator">=</span> <span class="token function">extendDeep</span><span class="token punctuation">(</span>papa<span class="token punctuation">)</span>
kid<span class="token punctuation">.</span>counts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
kid<span class="token punctuation">.</span>counts<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1, 2, 3, 4, 5</span>
papa<span class="token punctuation">.</span>counts<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1, 2, 3, 4</span>

papa<span class="token punctuation">.</span>reads <span class="token operator">===</span> kid<span class="token punctuation">.</span>reads <span class="token comment">// false</span>
kid<span class="token punctuation">.</span>reads<span class="token punctuation">.</span>paper <span class="token operator">=</span> <span class="token boolean">false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>papa<span class="token punctuation">.</span>reads<span class="token punctuation">.</span>paper<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><h4 id="混入"><a href="#混入" aria-hidden="true" class="header-anchor">#</a> 混入</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> arg<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> child <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>arg <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> arg <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> arg<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>prop <span class="token keyword">in</span> arguments<span class="token punctuation">[</span>arg<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>arg<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        child<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>arg<span class="token punctuation">]</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> child
<span class="token punctuation">}</span>

<span class="token keyword">var</span> cake <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>eggs<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> large<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>butter<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> salted<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>flour<span class="token punctuation">:</span> <span class="token string">'3 cups'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>sugar<span class="token punctuation">:</span> <span class="token string">'sure!'</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><h4 id="借用方法"><a href="#借用方法" aria-hidden="true" class="header-anchor">#</a> 借用方法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> one <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'obj'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">say</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">greet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> greet <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> two <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'another obj'</span>
<span class="token punctuation">}</span>

one<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span> <span class="token comment">// hello obj</span>
one<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>tow<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'hi'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// hi another obj</span>
</code></pre></div><p>bind()绑定</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> say <span class="token operator">=</span> one<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">say</span><span class="token punctuation">(</span><span class="token string">'hoho'</span><span class="token punctuation">)</span> <span class="token comment">// hoho undefined</span>

<span class="token keyword">var</span> yetanother <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'yet another obj'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">method</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">'hola'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

yetanother<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span>one<span class="token punctuation">.</span>say<span class="token punctuation">)</span> <span class="token comment">// holla undefined</span>
</code></pre></div><p>以上两种情况，say()方法内部的this都指向了全局变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">m</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> towsay <span class="token operator">=</span> <span class="token function">bind</span><span class="token punctuation">(</span>tow<span class="token punctuation">,</span> one<span class="token punctuation">.</span>say<span class="token punctuation">)</span>
<span class="token function">twosay</span><span class="token punctuation">(</span><span class="token string">'yoyo'</span><span class="token punctuation">)</span> <span class="token comment">// yoyo another object</span>
</code></pre></div><h4 id="function-prototype-bind"><a href="#function-prototype-bind" aria-hidden="true" class="header-anchor">#</a> Function.prototype.bind()</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>bind <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">thisArg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
        slice <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">,</span>
        args <span class="token operator">=</span> <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> one <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'obj'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">say</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">greet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> greet <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> two <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'another obj'</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> twosay2 <span class="token operator">=</span> one<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span>
<span class="token function">twosay2</span><span class="token punctuation">(</span><span class="token string">'Bonjour'</span><span class="token punctuation">)</span> <span class="token comment">// Bonjour another obj</span>
</code></pre></div><h2 id="设计模式"><a href="#设计模式" aria-hidden="true" class="header-anchor">#</a> 设计模式</h2> <h3 id="单例模式"><a href="#单例模式" aria-hidden="true" class="header-anchor">#</a> 单例模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">this</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>band <span class="token operator">=</span> <span class="token string">'Big'</span>

  <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> instance
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uni <span class="token operator">===</span> uni2<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// 缓存实例</span>
  <span class="token keyword">var</span> instance

  <span class="token comment">// 重新构造函数</span>
  <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> instance
  <span class="token punctuation">}</span>
  <span class="token comment">// 保留原型属性</span>
  <span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span>

  <span class="token comment">// 实例</span>
  instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 重置构造函数指针</span>
  instance<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Universe

  <span class="token comment">// 所有功能</span>
  instance<span class="token punctuation">.</span>strat_time <span class="token operator">=</span> <span class="token number">0</span>
  instance<span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">'Big'</span>

  <span class="token keyword">return</span> instance
<span class="token punctuation">}</span>
</code></pre></div><p>测试实例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 更新原型并创建实例</span>

<span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>nothing <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">var</span> uni <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token class-name">Universe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>everything <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">var</span> uni2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 比较</span>
uni <span class="token operator">==</span> uni2 <span class="token comment">// true</span>

<span class="token comment">// 所有原型属性都起作用了</span>
uni<span class="token punctuation">.</span>nothing <span class="token operator">&amp;&amp;</span> uni<span class="token punctuation">.</span>everything <span class="token operator">&amp;&amp;</span> uni2<span class="token punctuation">.</span>nothing <span class="token operator">&amp;&amp;</span> uni2<span class="token punctuation">.</span>everything <span class="token comment">// true</span>

<span class="token comment">// 正常属性</span>
uni<span class="token punctuation">.</span>bang <span class="token comment">// 'Big'</span>

<span class="token comment">// 该构造函数指向正确</span>
uni<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Universe <span class="token comment">// true</span>
</code></pre></div><p>另外一种解决方案</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function">Universe</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> instance

  <span class="token function-variable function">Universe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">Universe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> instance
    <span class="token punctuation">}</span>
    instance <span class="token operator">=</span> <span class="token keyword">this</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bang <span class="token operator">=</span> <span class="token string">'Big'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="工厂模式"><a href="#工厂模式" aria-hidden="true" class="header-anchor">#</a> 工厂模式</h3> <p>设计工厂模式的目的是为了创建对象，它通过在类或者类的静态方法中实现，具有下列目标</p> <ul><li>当创建相似对象时执行重复操作</li> <li>在编译时不知道具体类型(类)的情况下，为工厂客户提供一种创建对象的接口</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父构造函数</span>
<span class="token keyword">function</span> <span class="token function">CarMaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 普通方法</span>
<span class="token class-name">CarMaker</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">drive</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'Vroom, I have '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>doors <span class="token operator">+</span> <span class="token string">'doors'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 静态工厂方法</span>
CarMaker<span class="token punctuation">.</span><span class="token function-variable function">factory</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> constr <span class="token operator">=</span> type<span class="token punctuation">,</span>
      newcar
  <span class="token comment">// 如果不存在，抛出异常</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> CarMaker<span class="token punctuation">[</span>constr<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'Error'</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> constr <span class="token operator">+</span> <span class="token string">'doesn‘t exist'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 构造函数是已知存在的，我们使得原型继承父类，但仅继承一次</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> CarMaker<span class="token punctuation">[</span>constr<span class="token punctuation">]</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>drive <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    CarMaker<span class="token punctuation">[</span>constr<span class="token punctuation">]</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarMaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 创建一个新实例</span>
  newcar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarMaker</span><span class="token punctuation">[</span>constr<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 返回新实例</span>
  <span class="token keyword">return</span> newcar
<span class="token punctuation">}</span>

<span class="token comment">// 定义特定的汽车制造商</span>
CarMaker<span class="token punctuation">.</span><span class="token function-variable function">Compact</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>doors <span class="token operator">=</span> <span class="token number">4</span>
<span class="token punctuation">}</span>

CarMaker<span class="token punctuation">.</span><span class="token function-variable function">Convertible</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  tihs<span class="token punctuation">.</span>doors <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

CarMaker<span class="token punctuation">.</span><span class="token function-variable function">SUV</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>doors <span class="token operator">=</span> <span class="token number">24</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> corolla <span class="token operator">=</span> CarMaker<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'Compact'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> solstice <span class="token operator">=</span> CarMaker<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'Convertible'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> cherokee <span class="token operator">=</span> CarMaker<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'SUV'</span><span class="token punctuation">)</span>

corolla<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Vroom, I have 4 doors</span>
solstice<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Vroom, I have 2 doors</span>
cherokee<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Vroom, I have 24 doors</span>
</code></pre></div><h4 id="内置对象工厂"><a href="#内置对象工厂" aria-hidden="true" class="header-anchor">#</a> 内置对象工厂</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    s <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    b <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

o<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Object  <span class="token comment">// true</span>
n<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Number  <span class="token comment">// true</span>
s<span class="token punctuation">.</span>constructor <span class="token operator">===</span> String  <span class="token comment">// true</span>
b<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Boolean  <span class="token comment">// true</span>
</code></pre></div><h3 id="迭代器模式"><a href="#迭代器模式" aria-hidden="true" class="header-anchor">#</a> 迭代器模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> agg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      length <span class="token operator">=</span> data<span class="token punctuation">.</span>length

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> element

      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>

      element <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
      index <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">2</span>
      <span class="token keyword">return</span> element
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">hasNext</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> index <span class="token operator">&lt;</span> length
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">rewind</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">current</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 循环 1， 3， 5</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>agg<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>agg<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 回退</span>
agg<span class="token punctuation">.</span><span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>agg<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><h3 id="装饰者模式"><a href="#装饰者模式" aria-hidden="true" class="header-anchor">#</a> 装饰者模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Sale</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price <span class="token operator">||</span> <span class="token number">100</span>
<span class="token punctuation">}</span>

<span class="token class-name">Sale</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getPrice</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price
<span class="token punctuation">}</span>

<span class="token class-name">Sale</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">decorator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">F</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      overrides <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>decorators<span class="token punctuation">[</span>decorator<span class="token punctuation">]</span><span class="token punctuation">,</span>
      i<span class="token punctuation">,</span> newobj

  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span>

  newobj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  newobj<span class="token punctuation">.</span>uber <span class="token operator">=</span> <span class="token class-name">F</span><span class="token punctuation">.</span>prototype
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> overrides<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>overrides<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newobj<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> overrides<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> newobj
<span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>fedtax <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getPrice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> price <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uber<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    price <span class="token operator">+=</span> price <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token number">100</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span><span class="token function-variable function">quebec</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getPrice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> price <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uber<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    price <span class="token operator">+=</span> price <span class="token operator">*</span> <span class="token number">7.5</span> <span class="token operator">/</span> <span class="token number">1000</span>
    <span class="token keyword">return</span> price
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span><span class="token function-variable function">money</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getPrice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'$'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uber<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span><span class="token function-variable function">cdn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getPrice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'CDN$'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uber<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="使用列表实现"><a href="#使用列表实现" aria-hidden="true" class="header-anchor">#</a> 使用列表实现</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> sale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sale</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
sale<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token string">'fedtax'</span><span class="token punctuation">)</span>
sale<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token string">'quebec'</span><span class="token punctuation">)</span>
sale<span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token string">'money'</span><span class="token punctuation">)</span>
sale<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">Sale</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token punctuation">(</span>price <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">100</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>decorators_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>fedtax <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getPrice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> price <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token number">100</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>quebec <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getPrice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> price <span class="token operator">*</span> <span class="token number">7.5</span> <span class="token operator">/</span> <span class="token number">100</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>money <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">getPrice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">price</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'$'</span> <span class="token operator">+</span> price<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Sale</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">decorate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">decorator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>decorators_list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>decorator<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Sale</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getPrice</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> price <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">,</span>
      i<span class="token punctuation">,</span>
      max <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>decorators_list<span class="token punctuation">.</span>length

  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>decorators_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    price <span class="token operator">=</span> Sale<span class="token punctuation">.</span>decorators<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> price
<span class="token punctuation">}</span>
</code></pre></div><p>使用列表实现的装饰者模式更为简单，并且不涉及到继承。装饰的方法也非常的简单。</p> <h3 id="策略模式"><a href="#策略模式" aria-hidden="true" class="header-anchor">#</a> 策略模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> validator <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 所有可用的检查</span>
  types<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 当前验证会话中的错误消息</span>
  message<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

  config<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 接口方法</span>
  <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> type<span class="token punctuation">,</span> checker<span class="token punctuation">,</span> result_ok
    <span class="token comment">// 重置消息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        type <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        checker <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>types<span class="token punctuation">[</span>type<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 不需要验证</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>checker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">'ValidationError'</span><span class="token punctuation">,</span>
          message<span class="token punctuation">:</span> <span class="token string">'No handler to validate type'</span> <span class="token operator">+</span> type
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      result_ok <span class="token operator">=</span> checker<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>result_ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        msg <span class="token operator">=</span> <span class="token string">'invalid value for *'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">'*, '</span> <span class="token operator">+</span> checker<span class="token punctuation">.</span>instructions
        <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">hasErrors</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  first_name<span class="token punctuation">:</span> <span class="token string">'Super'</span><span class="token punctuation">,</span>
  last_name<span class="token punctuation">:</span> <span class="token string">'man'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token string">'unknow'</span><span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token string">'^~^'</span>
<span class="token punctuation">}</span>

validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>validator<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

validator<span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">{</span>
  first_name<span class="token punctuation">:</span> <span class="token string">'isNonEmpty'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token string">'isNumber'</span><span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token string">'isAlphaNum'</span>
<span class="token punctuation">}</span>

<span class="token comment">// 非空值检查</span>
validator<span class="token punctuation">.</span>types<span class="token punctuation">.</span>isNonEmpty <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token operator">!==</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  instructions<span class="token punctuation">:</span> <span class="token string">'the value connot be empty'</span>
<span class="token punctuation">}</span>

validator<span class="token punctuation">.</span>types<span class="token punctuation">.</span>isNumber <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  instructions<span class="token punctuation">:</span> <span class="token string">'the value can only be a valid number'</span>
<span class="token punctuation">}</span>

validator<span class="token punctuation">.</span>types<span class="token punctuation">.</span>isAlphaNum <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token regex">/[^a-z0-9]/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  instructions<span class="token punctuation">:</span> <span class="token string">'the value can only contain charcters and numbers, no special symbols'</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="外观模式"><a href="#外观模式" aria-hidden="true" class="header-anchor">#</a> 外观模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myevent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">stop</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> e<span class="token punctuation">.</span>preventDefault <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> e<span class="token punctuation">.</span>stopPropagation <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// IE浏览器</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> e<span class="token punctuation">.</span>returnValue <span class="token operator">===</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> e<span class="token punctuation">.</span>cancelBubble <span class="token operator">===</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token function">cancelBubble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="代理模式"><a href="#代理模式" aria-hidden="true" class="header-anchor">#</a> 代理模式</h3> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新: </span> <span class="time">3/8/2020, 3:51:36 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0ab71c88.js" defer></script><script src="/assets/js/2.e4689b75.js" defer></script><script src="/assets/js/111.23239fca.js" defer></script>
  </body>
</html>
