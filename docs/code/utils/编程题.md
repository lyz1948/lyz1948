# 编程题

## 打印 `#`

```js
function printStr() {
  var str = ''

  for (let i = 0; i < 8; i++) {
    str += '#'
    console.log(str)
  }
}
```

## 打印 BizzFuzz

打印从 1-100 之间的数组，如果数字被 3 整除，不打印数字，打印 Bizz, 如果数字被 5 整除，打印 Fuzz。如果同时被 3 和 5 整除，打印 BizzFuzz

```js
function printNumber() {
  for (let i = 1; i <= 100; i++) {
    let output = ''
    if (i % 3 === 0) output += 'Bizz'
    if (i % 5 === 0) output += 'Fuzz'
    // console.log(output || i)
  }
}
```

## 错峰打印 `#` 字

```js
function print(size) {
  size = size || 8
  let str = ''
  for (let i = 0; i < size; i++) {
    for (let j = 0; j < size; j++) {
      if ((i + j) % 2 === 0) {
        str += '#'
      } else {
        str += ' '
      }
    }
    str += '\n'
  }
  console.log(str)
}
print(16)
```

## 递归方式编写 Math.pow() 函数

```js
var power = function(base, exponent) {
  let result = 1
  for (let i = 0; i < exponent; i++) {
    result *= base
  }
  return result
}
console.log(power(2, 10))
```

## range 函数

```js
function range(start, end, step) {
  const result = []
  step = step || 1
  // 正序
  if (step > 0) {
    for (let i = start; i <= end; i += step) {
      result.push(i)
    }
  } else {
    // 倒序
    for (let i = start; i >= end; i += step) {
      result.push(i)
    }
  }
  return result
}
```

## 数组转列表

```js
function arrayToList(arr) {
  const len = arr.length
  let list = null

  for (let i = len; i >= 0; i--) {
    list = { value: arr[i], rest: list }
  }

  return list
}

arrayToList(1, 2, 3)
// {value: 1, rest: { value: 2, rest: { value: 3, rest: null }}}
```

## 列表转数组

```js
function listToArray(list) {
  const result = []

  for (let node = list; node; node = list.rest) {
    result.push(node.value)
  }

  return result
}

const list = { value: 1, rest: { value: 2, rest: { value: 3, rest: null } } }
listToArray(list)
// [1, 2, 3]
```

## prepend 函数

```js
function prepend(value, list) {
  return { value, rest: list }
}
```

## nth 函数

```js
function nth(list, n) {
  if (!list) return undefined
  if (n === 0) return list.value
  return nth(list.rest, n - 1)
}
```

## deepEqual 函数

```js
function deepEqual(a, b) {
  if (a === b) return true

  if (a == null || typeof a != 'object' || b == null || typeof b != 'object') return false

  const keysA = Object.keys(a)
  const keysB = Object.keys(b)

  if (keysA.length !== keysB.length) return false

  for (let k of keysA) {
    if (!keysB.inclouds(k)) || !deepEqual(a[k], b[k]) return false
  }

  return true
}
```

## 扁平数组

```js
const arr = [[1, 2, 3], [10, 11, 12], [20, 21, 22]]

const flatArray = arr =>
  arr.reduce((acc, cur) => {
    return acc.concat(Array.isArray(cur) ? flatArray(cur) : cur)
  }, [])
```

## loop 函数

```js
function loop(start, test, update, body) {
  for (let value = start; test(value); value = update(value)) {
    body(value)
  }
}

loop(5, n => n > 0, n => n - 1, console.log)
```

## every 函数

```js
function every(array, action) {
  for (let i = 0; i < array.length; i++) {
    if (!action(array[i])) return false
  }
  return true
}
```

## some 函数

```js
function some(array, action) {
  for (let value of array) {
    if (action(value)) return true
  }
  return false
}
```

## groupBy 函数

```js
function groupBy(array, groupOf) {
  const groups = {}

  for (let item of array) {
    const groupName = groupOf(item)
    if (groupName in groups) {
      groups[groupName].push(item)
    } else {
      groups[groupName] = [item]
    }
  }
}
```

## Vector 构造函数

```js
function Vector(x, y) {
  this.x = x
  this.y = y
}

Vector.prototype.plus = function(vector) {
  const { x, y } = vector
  return new Vector(x: this.x + x, y: this.y + y)
}

Vector.prototype.minus = function(vector) {
  const { x, y } = vector
  return new Vector(x: this.x - x, y: this.y - y)
}

Object.defineProperty(Vector.prototype, 'length', {
  get function() {
    return Math.sqrt(this.x * this.x + this.y * this.y)
  }
})

```

## StretchCell 单元格

```js
function StretchCell(inner, width, height) {
  this.inner = inner
  this.width = width
  this.height = height
}

StretchCell.prototype.minWidth = function() {
  return Math.min(this.inner.minWidth(), this.width)
}

StretchCell.prototype.minHeight = function() {
  return Math.min(this.inner.minHeight(), this.height)
}

StretchCell.prototype.draw = function(width, height) {
  return this.inner.draw(width, height)
}
```

## Group

```js
class Group {
  constructor() {
    this.elements = []
  }

  static from(values) {
    let group = new Group()

    for (let val of values) {
      group.add(val)
    }

    return group
  }

  add(val) {
    if (!this.has(val)) {
      this.elements.push(val)
    }
  }

  has(val) {
    return this.elements.includes(val)
  }

  delete(val) {
    const fIndex = this.elements.findIndex(v => v === val)
    if (fIndex > 0) {
      this.elements.splice(fIndex, 1)
    }
    return fIndex
  }

  [Symbol.iterator]() {
    return new GroupIterator(this)
  }
}

class GroupIterator() {
  constructor(group) {
    this.group = group
    this.position = 0
  }

  next() {
    if (this.position >= this.group.elements.length) {
      return { value: null, done: true }
    } else {
      const result = { value: this.elements[this.position], done: false  }
      this.position++
      return result
    }
  }
}
```

## logFive 函数

如果列表元素少于 5 个，打印所有元素，否则打印前 5 个元素

```js
function logFive(sequence) {
  for (let i = 0; i < 5; i++) {
    if (!sequence.next()) break
    console.log(sequence.current)
  }
}

function ArraySeq(array) {
  this.pos = -1
  this.array = array
}

ArraySeq.prototype.next = function() {
  if (this.pos >= this.array.length - 1) return false
  this.pos++
  return true
}

ArraySeq.prototype.current = function() {
  return this.array[this.pos]
}

function RangeSeq(from, to) {
  this.pos = from - 1
  this.to = to
}

RangeSeq.prototype.next = function() {
  if (this.pos >= this.to) return false

  this.pos++
  return true
}

RangeSeq.prototype.current = function() {
  return this.pos
}

logFive(new ArraySeq([1, 2, 3]))
logFive(new RangeSeq(200, 300))

function logFive2(sequence) {
  for (let i = 0; i < 5 && sequence != null; i++) {
    console.log(sequence.head())
    sequence = sequence.rest()
  }
}

function ArraySeq2(array, offset) {
  this.array = array
  this.offset = offset
}

ArraySeq2.prototype.rest = function() {
  return ArraySeq2.make(this.array, this.offset + 1)
}

ArraySeq2.prototype.head = function() {
  return this.array[this.offset]
}

ArraySeq2.make = function(array, offset) {
  if (offset == null) offset = 0
  if (offset >= array.length) {
    return null
  } else {
    return new ArraySeq2(array, offset)
  }
}

function RangeSeq2(from, to) {
  this.from = from
  this.to = to
}

RangeSeq2.prototype.head = function() {
  return this.from
}

RangeSeq2.prototype.rest = function() {
  return RangeSeq2.make(this.from + 1, this.to)
}

RangeSeq2.make = function(from, to) {
  if (from > to) return null
  return new RangeSeq2(from, to)
}

logFive2(new ArraySeq2.make([1, 2, 3]))
logFive2(new RangeSeq2.make(1, 100))
```

## 错误处理

```js
function MultiplicatorUnitFailure() {}

function primitiveMultiply(a, b) {
  if (Math.random() < 0.5) return a * b
  else throw new MultiplicatorUnitFailure()
}

function reliableMultiply(a, b) {
  try {
    return primitiveMultiply(a, b)
  } catch (e) {
    if (!(e instanceof MultiplicatorUnitFailure)) throw e
  }
}

console.log(reliableMultiply(8, 8))
```

### 上锁的箱子

```js
const box = {
  locked: true,
  unlock: function() {
    this.locked = false
  },
  lock: function() {
    this.locked = true
  },
  _content: [],
  get content() {
    if (this.locked) throw new Error('Locked')
    return this._content
  }
}

function withBoxUnlocked(fn) {
  const locked = box.locked

  if (!locked) {
    return fn()
  }

  box.unlock()
  try {
    return fn()
  } catch(e) {
    box.lock()
  }

  return box.content()
}
```
