# Javascript高级程序设计

## 基本概念

### 数据类型

#### Number() 数值转换规则

- 如果是Boolean值，true => 1; false => 0;
- 如果是数值，直接返回，不做任何处理
- 如果是null, null => 0;
- undefined => NaN;
- 如果是字符串：
  - 字符串只包含数字（正负号的情况），转换成数字，0开头的会忽略。 '123' => 123; '0456' => 456;
  - 字符串包含浮点格式，'3.3' => 3.3; '05.5' => 5.5; '-1.2' => 1.2;
  - 如果字符串包含16进制格式，带有'0xf'字符转换成对应的十进制整数;
  - 如果字符串是空，'' => 0; "" => 0;
  - 除上述情况以外，都是NaN;
- 如果是对象，则调用`valueOf()`方法，按照上面的规则转换，如果返回了NaN的话，则调用`toString()`方法，再依次按照前面的规则转换。

#### parseInt()

- 空字符串 => NaN
- 字符串数字 => 忽略字符，连续的字符串数字，一旦出现非数字，则停止
- 字符串小数点 => 忽略点后面的数字
- "0"开头且后面跟的是数字 => 八进制解析
- "0x"开头且后面跟的是数字 => 十六进制

```js
let n1 = parseInt('')  // NaN
let n2 = parseInt('123abc456')  // 123
let n3 = parseInt('11.3')  // 11
let n4 = parseInt('70')  // 70(十进制)
let n5 = parseInt('070')  // 56(八进制)
let n6 = parseInt('0xf')  // 15(十六进制)
```

如果指定第二个参数的话，字符串可以不带"0x"

```js
let n1 = parseInt('ab', 16) // 171
let n2 = parseInt('10', 2) // 2
let n2 = parseInt('100', 8) // 8
```

> 如果不指定`parseInt()`的第二个参数，默认情况下以10进制转换, 为了避免错误解析，建议任何时候都指定第二个参数

#### parseFloat()

`parseFloat` 与 `parseInt`一样，将字符串解析成数字，区别在于：

- 在解析浮点数时，只有第一个点有效，后面的会直接忽略
- 忽略前导零
- 没有第二个参数

```js
let n1 = parseFloat('')  // NaN
let n2 = parseFloat('123abc456')  // 123
let n3 = parseFloat('11.3')  // 11.3
let n4 = parseFloat('22.2.3')  // 22.3
let n5 = parseFloat('070.2')  // 70.2
let n6 = parseFloat('0xf')  // 0
let n7 = parseFloat('3.25e5')  // 325000
```

#### String 类型

**1. 字符串字面量**
String数据类型包含一些特殊的字符串字面量，也叫转义字符

```js
\n  换行
\t  制表
\b  空格
\r  回车
\f  进纸
\\  斜杠
\'  单引号（'），在单引号表示的字符串中使用。e: 'hello \'world\''
\"  双引号（"），在双引号表示的字符串中使用。e: "hello \"world\""
\xnn 以十六进制代码nn表示一个字符
\unnnn 以十六进制代码nnnn表示一个Unicode字符
```

**2. 字符串的特点**
字符串是不可变的，一但创建，它们的值就不能在改变。

```js
var hi = 'hello' // 创建字符串'hello'
hi = hi + 'world' // 重新定义字符串'hello world'，之前的hello将被销毁掉
```

**3. 转换字符串**
把一个值转换成一个字符串的两种方式

数值，布尔值、对象和字符串都有toString()方法，该方法返回字符串副标，null 和 undefined没有

```js
let num = 10
num.toString() // '10'
num.toString(2) // '1010'
num.toString(8) // '12'
num.toString(10) // '10'
num.toString(16) // 'a'
```

String()方法
在不知道要转换的类型是不是null 或 undefined 的情况下，可以使用String()，这个函数能够将任何类型的值转换为字符串

- 如果值有toString()方法，则调用该方法（没有参数）并返回相应的结果
- 如果值是 null，返回 ‘null’
- 如果值是 undefined, 返回 ‘undefined’

#### Object 类型

**constructor**
保存着用于创建当前对象的函数

**hasOwnProperty(propertyName)**
用户检查给定的属性在当前对象实例中（而不是在实例的原型中）

**isPropertyOf(object)**
检查传入的对象是否是传入对象的原型

### 操作符

操作符应用在对象的时候，先调用对象的 `valueOf()` 或 `toString()` 方法取值

#### 一元操作符

**递增和递减操作符**

2种类型，分别为前置和后置。前置递增或递减操作时，变量的值在语句被求值前改变的，这种情况被称为副效应

前置/后置递增和递减操作适用任何类型，对应不同类型做对应的规则处理：

- 有效数字的字符串，先转换为数字值，再执行加减 1 操作。对应的类型也变为数值类型。
- 字符串不是有效的数字，返回 NaN，变量类型变为数值类型。
- 布尔值 false 时，转换为 0 再执行加减 1 操作。类型变成数值。
- 布尔值 true 时，转换为 1 再执行加减 1 操作。类型变成数值。
- 如果是对象，先调用对象的 valueOf() 方法，获取对应的值，再按照上面几条规则转换。如果结果是 NaN，则调用 toString() 方法后在按照前面的规则。类型变成数值型。

**一元加减操作符**

一元加减操作符在处理非数值类型时，按照上面的规制转换，转换后类型都是数值型。

**位操作符**

负数位操作符的步骤：

1. 求这个数的绝对值的二进制码
2. 求二进制反码，即将0替换成1，将1替换成0
3. 得到的二进制码加1

求-18的二进制码

```js
// 先求得-18的绝对值 18 的二进制码
0000 0000 0000 0000 0000 0000 0001 0010
// 二进制反码，即 0 变 1， 1 变 0
1111 1111 1111 1111 1111 1111 1110 1101
// 二进制反码加 1
1111 1111 1111 1111 1111 1111 1110 1101
                                      1
// -------------------------------------
1111 1111 1111 1111 1111 1111 1110 1110
```

按位非（NOT) `~`

25 二进制 0000 0000 0000 0000 0000 0000 0001 1001

```js
let num1 = 25
let num2 = ~num1
console.log(num2) // -26

```

按位与（AND）`&`
两个为1则为1，否则为0

```js
25 & 3 // 1
25 二进制 0000 0000 0000 0000 0000 0000 0001 1001
3  二进制 0000 0000 0000 0000 0000 0000 0000 0011
------------------------------------------------
AND =    0000 0000 0000 0000 0000 0000 0000 0001
```

按位或（OR）`|`
1个为1则为1，否则为0
```js
35 | 3 // 27
25 二进制 0000 0000 0000 0000 0000 0000 0001 1001
3  二进制 0000 0000 0000 0000 0000 0000 0000 0011
------------------------------------------------
OR  =    0000 0000 0000 0000 0000 0000 0001 1011
```

按位异或（XOR）`^`
两个相同则为0，否则为1

```js
25 ^ 3 // 26
25 二进制 0000 0000 0000 0000 0000 0000 0001 1001
3  二进制 0000 0000 0000 0000 0000 0000 0000 0011
------------------------------------------------
XOR  =   0000 0000 0000 0000 0000 0000 0001 1010
```

左移 `<<`
> 左移不会改变操作数的符号

```js
let num = 2 // 二进制码为 10
let num2 = num << 5 // 等于二进制码左移5位 1000000, 转换为10进制的 64
```

有符号右移 `>>`

```js
let num = 64 // 二进制是1000000
let num2 = num >> 5 // 二进制是 10，即十进制的 2
```

无符号右移 `>>>`
正数无符号右移与有符号右移相同

#### 布尔操作符

1、逻辑非 `!`

- 对象 => false
- 空字符串 => true
- 非空字符串 => false
- 0 => true
- 非0 => false
- null => true
- NaN => true
- undefined => true

2、逻辑与 `&&` true && false

- 第一个对象 => 后者
- 两个对象 => 后者
- 如果有null => null
- 如果有NaN => NaN
- 如果有undefined => undefined

3、逻辑或 `||` true || false

- 第一个是对象 => 返回第一个操作数
- 第一个为false => 返回第二个操作数
- 两个对象 => 返回第一个
- 两个null => null
- 两个NaN  => NaN
- 两个undefined => undefined

#### 乘性操作符

1、乘法 `*`

- 两个都是数值，执行常规的乘法计算，如果乘积超出数值表示范围 => Infinity 或 -Infinity
- 一个NaN => NaN
- Infinity 与 0 相乘 => 结果是NaN
- Infinity 与 非 0 相乘 => Infinity 或 -Infinity
- Infinity 与 Infinity 相乘 => Infinity
- 如果有一个操作数不是数值，先调用 Number() 隐式转换，然后再应用上面的规则

2、除法 `/`

- 两个都是数值，执行常规的除法计算，如果商超出数值表示范围 => Infinity 或 -Infinity
- 一个NaN => NaN
- Infinity / Infinity => 结果是NaN
- 0 / 0 => 结果是NaN
- 0 除以非零的有限数 => Infinity 或 -Infinity
- 任何数除以 Infinity => Infinity 或 -Infinity

3、求模 `%`

- 两个都是数值，常规除法计算 => 除得的余数
- 无穷大 % 有限大  => NaN
- 有限大 % 0 => NaN
- Infinity / Infinity => NaN
- 有限大 % Infinity => 返回自身
- 0 % 任何数（非0/-0/Infinity/-Infinity）=> 0
- 如果有一个操作数不是数值，先调用 Number() 隐式转换，然后再应用上面的规则

#### 加性操作符

1、加法 `+`

- 有NaN => NaN
- Infinity + Infinity => Infinity
- -Infinity + -Infinity => -Infinity
- Infinity + -Infinity => NaN
- 0 + 0 => 0
- -0 + -0 => -0
- -0 + 0 => 0
- 如果有一个数值是字符串，对应下面的规则转换
  - 两个操作数都是字符串，拼接字符串
  - 一个操作数是字符串，另一个也转为字符串，拼接处理
  - 如果有一个是对象，数值、布尔值，则调用它们的 `toString()` 方法取得字符串，按照上面的规则处理
  - undefined => 字符串 "undefined"
  - null => 字符串 "null"

2、减法 `+`

- 两个都是数值，正常减法运算
- 一个NaN => NaN
- Infinity - Infinity => NaN
- -Infinity - -Infinity => NaN
- Infinity - -Infinity => Infinity
- -Infinity - Infinity => -Infinity
- 0 - 0 => 0
- 0 - -0 => -0
- -0 - -0 => 0
- 如果有一个操作数是字符串、布尔值、null 或 undefined，则调用 Number() 函数转换为数值，然后按照

#### 关系操作符

- 两个数值，数值比较大小
- 两个字符串，比较字符串的字符编码值
- 一个是数值，则将另一个操作数转换为数值，得到的结果，在按照上面规则比较
- 一个是对象，调用valueOf()方法，如果没有valueOf()方法，则调用toString()方法，得到的结果再按照上面的规则进行比较
- 一个布尔值，转换为数值，在比较

#### 相等操作符

1、 相等和不相等 `==` 和 `!=`

- 一个是布尔值，false转换0，true 转换为1
- 一个是字符串，另一个是数值，先将字符串转换为数值
- 一个是对象，先调用valueOf()方法，的得到的基本类型再按照上面的规则进行比较

2、 null 和 undefined比较规则

- null 和 undefined 是相等的
- 比较之前，不能进行转换
- 一个是NaN，相等返回false, 不等返回true
- 两个NaN， 返回false
- 两个都是对象，比较是不是同一个对象，如果是true, 反之false

```js
null == undefined // true
"NaN" == NaN      // false
3 == NaN          // false
NaN == NaN        // false
NaN != NaN        // true
false == 0        // true
true == 1         // true
true == 2         // false
undefined == 0    // false 
null == 0         // false
"5" == 5          // true
```

2、 全等和不全等 `===` 和 `!==`

比较之前不做转换操作，其他规则同相等和不相等

#### 条件操作符

```js
let max = num1 > num2 ? num1 : num2
```

#### 赋值操作符

- 乘/赋值 （*=）
- 除/赋值 （/=）
- 模/赋值 （%=）
- 减/赋值 （+=）
- 减/赋值 （-=）
- 左移/赋值 （<<=）
- 有符号右移/赋值 （>>=）
- 无符号右移/赋值 （>>>=）

#### 逗号操作符

```js
let val1, val2, valn
```

### 语句

#### if语句

满足条件，执行语句

```js
if(true) {
  // TODO
}
```

#### do-while语句

不管是否满足条件，都会执行1次

```js
let age = 2
do {
  age += 2
} while(age < 10)
```

#### while语句

满足条件，重复执行语句

```js
let i = 0
while(i < 100) {  i += 5}
```

#### for语句

#### for-in语句

建议在使用for-in循环之前，检查对象是不是null 或 undefined

#### label语句

```js
mylabel: for(let i = 0 ; i < 10; i++) {}
```

#### break和continue语句

